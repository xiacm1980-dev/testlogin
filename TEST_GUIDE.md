# Aegis CDR 本地测试指南

## 🚀 测试环境状态

### 当前运行的服务

| 服务 | 地址 | 状态 |
|------|------|------|
| **前端** (React) | http://localhost:3000 | ✅ 运行中 |
| **环境清理工具** | file:///D:/gitlocal/testlogin/clear-env.html | ⚙️ 已创建 |

### ⚠️ 注意事项

- Node.js后端和C++文件清洗服务尚未启动（需要Docker或Linux环境）
- 当前只能测试前端功能（模拟数据）
- 文件上传功能需要后端服务支持

---

## 📋 测试步骤

### 第一步：清理环境

1. **打开清理工具**：
   - 在浏览器中打开：`file:///D:/gitlocal/testlogin/clear-env.html`
   - 或直接双击文件：`D:\gitlocal\testlogin\clear-env.html`

2. **查看当前数据**：
   - 页面会显示所有localStorage中的aegis数据
   - 显示每个数据项的大小

3. **执行清理**：
   - 点击 **"🗑️ 清除并重启"** 按钮
   - 确认弹窗
   - 等待3秒倒计时
   - 自动跳转到 http://localhost:3000

### 第二步：测试默认登录

清理后，系统会重置为默认状态：

#### 管理员账号（默认密码：`123456`）

| 角色 | 用户名 | 密码 | 权限 |
|------|--------|------|------|
| 系统管理员 | `sysadmin` | `123456` | 系统配置、用户管理、API设置 |
| 安全管理员 | `secadmin` | `123456` | 安全策略、威胁防护、文件/视频清洗 |
| 日志管理员 | `logadmin` | `123456` | 日志审计、报告生成 |

#### 普通用户账号

| 用户名 | 密码 | 姓名 |
|--------|------|------|
| `user01` | `password` | John Doe |

### 第三步：测试密码修改功能（重点测试）

#### 测试管理员密码修改

1. **登录系统**：
   - 使用 `sysadmin` / `123456` 登录

2. **修改密码**：
   - 点击右上角头像
   - 选择"修改密码"
   - 填写表单：
     ```
     旧密码：123456
     新密码：NewPass123!
     确认密码：NewPass123!
     ```
   - 点击"确认修改"

3. **退出登录**

4. **使用新密码登录**：
   - 用户名：`sysadmin`
   - 密码：`NewPass123!`
   - ✅ 应该能成功登录

5. **刷新页面测试持久化**：
   - 按 F5 或 Ctrl+R 刷新页面
   - 再次使用新密码登录
   - ✅ 应该仍然能成功登录

#### 测试普通用户密码修改

1. **登录系统**：
   - 使用 `user01` / `password` 登录

2. **修改密码**：
   - 点击右上角"账号"按钮
   - 切换到"密码修改"标签
   - 填写表单：
     ```
     旧密码：password
     新密码：UserPass123!
     确认密码：UserPass123!
     ```
   - 点击"确认修改"

3. **退出并测试新密码**：
   - 使用 `user01` / `UserPass123!` 登录
   - ✅ 应该能成功登录

### 第四步：测试其他功能

#### 用户管理（SYSADMIN）

1. 进入"用户管理"页面
2. 添加新用户：
   ```
   用户ID: user02
   姓名: Jane Smith
   单位: IT部门
   部门: 开发组
   联系方式: 555-0102
   初始密码: TempPass123!
   ```
3. 编辑用户信息
4. 删除用户

#### 安全策略（SECADMIN）

1. 进入"安全策略"页面
2. 添加防火墙规则
3. 启用/禁用规则
4. 删除规则

#### 文件清洗（SECADMIN / USER）

⚠️ **需要后端服务支持，当前只能测试UI**

1. 进入"文件清洗"页面
2. 点击上传按钮
3. 选择文件（会显示"模拟清洗"）

#### 日志审计（LOGADMIN）

1. 进入"日志审计"页面
2. 查看系统日志
3. 查看管理员操作日志
4. 搜索和过滤日志

---

## 🔧 如果遇到问题

### 问题1：修改密码后还是无法登录

**解决方案**：
1. 打开浏览器开发者工具（F12）
2. 进入 Console 标签
3. 执行以下命令查看存储的密码哈希：
   ```javascript
   JSON.parse(localStorage.getItem('aegis_db_admins'))
   ```
4. 检查是否正确保存了新密码

### 问题2：页面刷新后数据丢失

**原因**：可能是浏览器隐私模式或localStorage被禁用

**解决方案**：
1. 确保不在隐私/无痕模式
2. 检查浏览器设置中localStorage是否启用
3. 尝试清除浏览器缓存后重试

### 问题3：清理工具无法打开

**解决方案**：
```bash
# 在testlogin目录打开文件
cd D:\gitlocal\testlogin
start clear-env.html

# 或者在浏览器地址栏输入
file:///D:/gitlocal/testlogin/clear-env.html
```

### 问题4：前端服务启动失败

**解决方案**：
```bash
# 停止当前服务（Ctrl+C）
cd D:\gitlocal\testlogin

# 清理并重新安装依赖
rm -rf node_modules
npm install

# 重新启动
npm run dev
```

---

## 🧪 测试检查清单

使用以下清单确保所有功能正常：

### ✅ 认证功能
- [ ] SYSADMIN 默认密码登录
- [ ] SECADMIN 默认密码登录
- [ ] LOGADMIN 默认密码登录
- [ ] USER 默认密码登录
- [ ] 修改管理员密码成功
- [ ] 使用新管理员密码登录成功
- [ ] 修改普通用户密码成功
- [ ] 使用新用户密码登录成功
- [ ] 页面刷新后新密码仍然有效
- [ ] 错误密码无法登录
- [ ] 退出登录功能正常

### ✅ 用户管理（SYSADMIN）
- [ ] 查看用户列表
- [ ] 添加新用户
- [ ] 编辑用户信息
- [ ] 删除用户
- [ ] 搜索用户

### ✅ 系统配置（SYSADMIN）
- [ ] 查看系统信息
- [ ] 修改系统配置
- [ ] 查看服务状态

### ✅ 安全策略（SECADMIN）
- [ ] 查看防火墙规则
- [ ] 添加规则
- [ ] 启用/禁用规则
- [ ] 删除规则

### ✅ 威胁防护（SECADMIN）
- [ ] 查看威胁统计
- [ ] 修改DDoS阈值
- [ ] 查看攻击日志

### ✅ 日志审计（LOGADMIN）
- [ ] 查看系统日志
- [ ] 查看管理员日志
- [ ] 搜索日志
- [ ] 按严重程度过滤

### ✅ 报告生成（LOGADMIN）
- [ ] 生成审计报告
- [ ] 生成流量报告
- [ ] 生成合规报告
- [ ] 查看报告列表

### ✅ UI/UX
- [ ] 多语言切换（中文/英文）
- [ ] 响应式布局
- [ ] 深色主题（如果支持）
- [ ] 导航栏功能正常
- [ ] 面包屑导航正常

---

## 📝 测试报告模板

测试完成后，可以使用以下模板记录结果：

```markdown
# Aegis CDR 测试报告

**测试时间**：2025-12-12
**测试环境**：Windows + Chrome浏览器
**测试版本**：本地开发版

## 测试结果总览

| 功能模块 | 测试用例数 | 通过 | 失败 | 备注 |
|----------|------------|------|------|------|
| 认证功能 | 11 | 11 | 0 | ✅ 密码修改bug已修复 |
| 用户管理 | 5 | 5 | 0 | ✅ 正常 |
| 安全策略 | 4 | 4 | 0 | ✅ 正常 |
| 日志审计 | 4 | 4 | 0 | ✅ 正常 |

## 重点测试：密码修改功能

### 管理员密码修改
- ✅ 修改成功
- ✅ 新密码登录成功
- ✅ 刷新后仍可登录

### 普通用户密码修改
- ✅ 修改成功
- ✅ 新密码登录成功
- ✅ 刷新后仍可登录

## 发现的问题

无

## 建议

1. 后续集成后端服务测试文件上传功能
2. 添加更多密码强度验证测试
```

---

## 🎯 快速测试脚本（可选）

如果想要自动化测试，可以在浏览器控制台运行：

```javascript
// 测试密码修改的快速脚本
async function testPasswordChange() {
    console.log('🧪 开始测试密码修改功能...');

    // 1. 检查localStorage
    const admins = JSON.parse(localStorage.getItem('aegis_db_admins'));
    console.log('✓ 当前管理员账户:', admins);

    // 2. 模拟修改密码
    const backend = window.backend; // 假设backend服务已加载
    const result = backend.changePassword('sysadmin', 'SYSADMIN', '123456', 'NewPass123!');
    console.log('✓ 密码修改结果:', result);

    // 3. 验证新密码
    const authResult = backend.authenticateAdmin('SYSADMIN', 'NewPass123!');
    console.log('✓ 新密码验证:', authResult ? '成功 ✅' : '失败 ❌');

    // 4. 检查持久化
    const updatedAdmins = JSON.parse(localStorage.getItem('aegis_db_admins'));
    console.log('✓ 更新后的管理员账户:', updatedAdmins);

    console.log('🎉 测试完成！');
}

// 运行测试
testPasswordChange();
```

---

## 联系方式

如果测试过程中遇到任何问题，请记录：
1. 具体的操作步骤
2. 预期结果 vs 实际结果
3. 浏览器控制台的错误信息（F12 → Console）
4. 截图（如果有必要）
